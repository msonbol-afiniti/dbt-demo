version: 2

sources:
  - name: staging
    database: new_sample_db
    schema: dev

    # loaded_at_field: record_loaded_at
    tables:
      - name: callrecords
        description: >
          Call records data containing a detailed record that is generated for each call that arrives at a peripheral Contact Center environment. 
          The TCD record contains comprehensive information about the call, including customer and agent IDs, start time, end time, and agent site.
          Benchmark data is appended to the call record data by the client and shared in the same CSV file. 
          Data is shared daily as a csv file with 7 columns.
      
      - name: outcomes
        description: >
          Sales records as generated by the point-of-sale system for each sale interaction. The interaction may or may not end in an actual.
          A sale record should always have a unique identifier and should be attributed to an agent through the emp_id, and to a customer through cust_id.
          The sale flag indicates whether the sale interaction ended in a sale or not. This will be used as our binomial metric.
          Data is shared daily as a csv file with 5 columns.
        
        freshness:
          warn_after: {count: 3, period: minute}
          # error_after: {count: 6, period: hour}
        loaded_at_field: sale_time::timestamp

models:
  - name: stg_callrecords
    description: >
      Staging of the call records data where the data is type case to its correct format as illustrated below in the column data types,
      and an insert_date column is created to indicate when the data was staged. 
    columns:
      - name: call_id
        data_type: integer
        description: Primary key for this table, generated by the peripheral switch system
        data_tests:
          - unique:
              severity: warn
          - not_null:
              severity: error
              # severity: warn

      - name: emp_id
        data_type: integer
        description: The ID of the agent that answered the call 

      - name: cust_id
        data_type: character varying
        description: The ID of the customer who made the call 

      - name: benchmark
        data_type: integer
        description: Afiniti benchmark appended by the client

      - name: starttime
        data_type: timestamp without time zone
        description: Call start time
        data_tests:
          - not_null:
              severity: warn

      - name: endtime
        data_type: timestamp without time zone
        description: Call end time
        data_tests:
          - not_null:
              severity: warn

      - name: agent_site
        data_type: character varying
        description: >
          A code indicating the agent site that received the call
          A = Northeast
          B = Southeast
          C = Midwest     
          D = Southwest
          E = West Coast
        data_tests:
          - accepted_values:
              values: ['A','B','C','D','E']
              severity: warn

  - name: stg_outcomes
    description: >
      Staging of the outcomes data where the data is type case to its correct format as illustrated below in the column data types, 
      and an insert_date column is created to indicate when the data was staged. 
    columns:
      - name: sale_id
        data_type: integer
        description: Primary key for this table, generated by point-of-sale system to identify sale
        data_tests:
          - unique:
              severity: warn
          - not_null:
              severity: error
              # severity: warn

      - name: emp_id
        data_type: integer
        description: The ID of the agent that answered the call 

      - name: cust_id
        data_type: character varying
        description: The ID of the customer who made the call 

      - name: sale_flag
        data_type: integer
        description: The sale flag indicates whether an interaction ended in a sale (1) or not (0). All interactions must have a sale_flag value
        data_tests:
          - not_null:
              severity: error

      - name: sale_time
        data_type: timestamp without time zone
        description: The timestamp of the sale interaction